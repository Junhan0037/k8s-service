spring:
  application:
    name: research-service
  data:
    redis:
      # 로컬 개발 환경에서 Redis 연결 정보를 명시해 다단 캐시가 정상 동작하도록 한다.
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      timeout: 2s
  elasticsearch:
    # 검색 백엔드 연결 정보를 명시해 개발 환경 진입 장벽을 낮춘다.
    uris: ${ELASTICSEARCH_URIS:http://localhost:9200}
    connection-timeout: 2s
    socket-timeout: 3s
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    client-id: research-indexer
    consumer:
      group-id: research-indexer
      auto-offset-reset: earliest
    properties:
      isolation.level: read_committed
      max.poll.interval.ms: 300000
      session.timeout.ms: 45000
    listener:
      concurrency: 2

server:
  port: 8101

service:
  description: "임상 연구 검색 및 조회 기능을 제공하는 Research 서비스 스켈레톤"

app:
  messaging:
    topics:
      deid-jobs: deid.jobs

researchex:
  cache:
    # 정적 데이터는 1시간 동안 보관해 메타데이터 호출 부하를 줄인다.
    static-tier:
      ttl: PT1H
      maximum-size: 512
    # 동적 질의는 10분 TTL로 구성해 최신성을 확보하면서도 조회 비용을 낮춘다.
    dynamic-tier:
      ttl: PT10M
      maximum-size: 2048
    redis-key-prefix: "researchex::cache::"
  search:
    index-name: research-studies
    default-page-size: 20
    max-page-size: 100
    sortable-fields:
      - updatedAt
      - createdAt
      - relevance
      - enrollment
    query-timeout: PT2S
    sla-threshold: PT1S
  gateway:
    user:
      base-url: ${USER_PORTAL_BASE_URL:http://localhost:8200}
      client-type: WEBCLIENT
      connect-timeout: 2s
      read-timeout: 5s
    medical-record:
      base-url: ${MR_VIEWER_BASE_URL:http://localhost:8300}
      client-type: WEBCLIENT
      connect-timeout: 2s
      read-timeout: 5s
  security:
    secret: ${RESEARCHEX_INTERNAL_SECRET:researchex-internal-secret}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
        researchex.research.index.find-by-id: true
      slo:
        http.server.requests: 250ms,500ms,1s
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: ${ZIPKIN_ENDPOINT:http://zipkin:9411/api/v2/spans}
  observations:
    key-values:
      environment: ${RESEARCHEX_ENV:local}
